# 가상메모리

## Demand Paging

* 실제로 필요할 때 page를 메모리에 올리는 것 
  * I/O 양의 감소
  * Memory 사용량 감소
  * 빠른 응답 시간
  * 더 많은 사용자(프로그램) 수용
* Valid/ Invalid bit
  * Invalid의 경우 사용되지 않는 주소영역인 경우와 페이지가 물리적 메모리에 없는 경우에 해당한다.
  * 처음에는 모든 page entry가 invalid로 초기화 되어있다.
  * 주소 변환 시에 invalid이면 page fault가 발생한다.

### Page Fault

* Invalid page(비트가 invalid 상태)에 주소 변환을 위해서 접근하게 되면 MMU가 trap을 발생시킨다.(page fault trap)
* Kernel mode로 들어가서 page fault handler가 invoke된다.

#### Page fault 처리 순서

1. Invalid reference(잘못된 주소, protection violation(권한위반)) -> abort process
2. 빈 page frame을 가져온다. 빈 프레임이 없다면 교체한다.
3. 요청하는 페이지를 disk에서 memory로 읽어온다.
4. Disk I/O가 끝나기전까지 해당 프로세스는 block 상태가 된다.
5. Disk read가 끝나면 page tables entry에 기록하고, valid/invalid bit를 valid로 바꾼다.
6. ready queue에 process를 위치시킨다.

### 빈 frame이 없다면?

* page replacement
  * 어떤 frame을 빼앗아올지(교체시키질지) 결정해야한다.
  * 곧바로 사용되지 않을 page를 교체시키는 것이 효율적이다.
  * 동일한 페이지가 여러번 교체되는 상황이 생길 수 있다.

#### Replace Algorithm

* Page-fault rate를 최소화하는 것이 목표다.
* Page 참조 순서(Page reference string)에 대해서 page fault가 얼마나 발생하는지 조사하는 것으로 알고리즘을 평가한다.