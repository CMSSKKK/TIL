# 03

## 커널 주소 공간의 내용

* code
  * 커널코드
    * 시스템콜, 인터럽트 처리 코드
    * 자원 관리를 위한 코드
    * 편리한 서비스 제공을 위한 코드
* data(자료구조를 가지고 있음)
  * PCB --프로세스관리를 위한 자료구조(table)
  * CPU --cpu관리를 위한 자료구조(table)
  * memory --memory관리를 위한 자료구조(table)
  * disk -- disk관리를 위한 자료구조(table)
* stack
  * 프로세스의 커널 스택

## 사용자 프로그램이 사용하는 함수

* 함수

  * 사용자 정의함수
    * 자신의 프로그램에서 정의한 함수
  * 라이브러리 함수
    * 자신의 프로그램에서 정의하지 않고 갖다 쓴 함수
    * 자신의 프로그램의 실행 파일에 포함되어 있다

  * > 사용자 정의 함수와 라이브러리 함수는 프로세스의 코드 영역

  * 커널 함수

    * 운영체제 프로그램의 함수
    * 커널 함수의 호출 = 시스템 콜 

  * > 커널의 코드 영역



## 프로세스의 개념

* 프로세스의 문맥(context)

  > 과거에 cpu를 얼마나 사용했는가
  >
  > 메모리를 얼마나 차지했는가
  >
  > 파일은 몇 개나 열어뒀는가 등

  * CPU 수행 상태를 나타내는 하드웨어 문맥
    * Program Counter
    * 각종 register
  * 프로세스의 주소 공간
    * Code,data,stack
  * 프로세스 관련 커널 자료 구조
    * PCB
    * Kernel stack

## 프로세스의 상태

* Running

* Ready

* Blocked(wait, sleep)

  * CPU를 줘도 당장 instruction을 수행할 수 없는 상태

  * Process 자신이 요청한 event가 즉시 만족되지 않아 이를 기다리는 상태

  * > 하드웨어(I/O) 처리가 시간이 오래걸려서 blocked상태가 되는 것만은 아니다.
    >
    > 프로세스간의 공유 데이터를 같이 사용하게 될 때에도 blcoked 상태가 될 수 있다.

> * New : 프로세스가 생성중인 상태
> * Terminated : 수행이 끝난 상태



* Running 상태의 프로세스가 CPU 점유권을 내놓는 경우
  * Terminated
  * I/O or event wait
  * Timer interrupt



## PCB

* 운영체제가 각 프로세스를 관리하기 위해 프로세스당 유지하는 정보
* 다음의 구성 요소를 가진다 (구조체로 유지)
  * OS가 관리상 사용하는 정보
    * Process state, Process ID
    * scheduling information, priority
  * CPU 수행 관련 하드웨어 값
    * Program counter, registers
  * 메모리 관련
    * code, data, statck의 위치 정보
  * 파일 관련
    * Open file descriptors

## Context Switch

* CPU를 한 프로세스에서 다른 프로세스로 넘겨주는 과정
* CPU가 다른 프로세스에게 넘어갈 때 운영체제는 다음을 수행
  * CPU를 내어주는 프로세스의 상태를 그 프로세스의 PCB에 저장
  * CPU를 새롭게 얻는 프로세스의 상태를 PCB에서 읽어옴
* System call이나 Interrupt 발생시 반드시 context switch가 일어나는 것은 아님
  * context의 일부를 PCB에 저장하는 작업은 있다.



## 프로세스를 스케줄링하기 위한 큐

* Job queue
  * 현재 시스템 내에 있는 모든 프로세스의 집합
* Ready queue
  * 현재 메모리 내에 있으면서 CPU를 잡아서 실행되기를 기다리는 프로세스의 집합
* Device queues
  * I/O 디바이스의 처리를 기다리는 프로세스의 집합
* 프로세스들은 각 큐들을 오가며 수행된다



> 프로세스 - fork a child
>
> 자식 프로세스를 만드는 것(자신을 복제하는 것과 같다.)